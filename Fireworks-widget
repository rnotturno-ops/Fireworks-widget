<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fireworks Full Page</title>
  <style>
    :root{ --ui-bg: rgba(0,0,0,0.0); --ui-color: #fff; }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#05020a,#000)}
    #stage{position:relative;width:100%;height:100vh;overflow:hidden;display:flex;align-items:center;justify-content:center}
    canvas{display:block;width:100%;height:100%}
    #hint{position:fixed;left:12px;bottom:12px;color:rgba(255,255,255,0.9);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;font-size:13px;background:rgba(0,0,0,0.25);padding:8px 10px;border-radius:8px}
  </style>
</head>
<body>
  <div id="stage" style="width:100%;height:100vh;overflow:hidden;background:transparent;">
    <canvas id="c" aria-label="Fireworks canvas" role="img"></canvas>
  </div>
  <div id="hint">Tap or click anywhere to launch fireworks</div>

  <script>
  (() => {
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    let DPR = Math.max(1, window.devicePixelRatio || 1);
    let particles = [];
    let lastTime = 0;
    let sequenceTimer = null;
    function rand(a,b){ return Math.random()*(b-a)+a; }
    function resize(){
      DPR = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.floor((canvas.clientWidth || window.innerWidth) * DPR);
      canvas.height = Math.floor((canvas.clientHeight || window.innerHeight) * DPR);
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize', resize);
    resize();
    function createBurst(x,y,scale=1){
      const colors = ['#ff3b3b','#ff9f1c','#ffd166','#06d6a0','#118ab2','#9b5de5','#f15bb5'];
      const base = 18;
      const count = Math.max(6, Math.floor(base * scale * rand(0.8,1.2)));
      for(let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const s = rand(1.2,6.5)*scale;
        particles.push({
          x:x, y:y,
          vx:Math.cos(a)*s, vy:Math.sin(a)*s,
          life:rand(700,1200)*Math.max(0.9,scale), age:0,
          size:rand(1.2,3.6)*Math.max(0.8,scale),
          color: colors[(Math.random()*colors.length)|0]
        });
      }
    }
    function animate(t){
      if(!lastTime) lastTime = t;
      const dt = Math.min(48, t - lastTime);
      lastTime = t;
      ctx.clearRect(0,0,canvas.width/DPR,canvas.height/DPR);
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.age += dt;
        if(p.age >= p.life){ particles.splice(i,1); continue; }
        p.vy += 0.0025 * dt;
        p.vx *= Math.pow(0.999, dt/16);
        p.vy *= Math.pow(0.999, dt/16);
        p.x += p.vx * dt/16;
        p.y += p.vy * dt/16;
        ctx.globalAlpha = Math.max(0, 1 - p.age / p.life);
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
    function stopSequence(){ if(sequenceTimer){ clearTimeout(sequenceTimer); sequenceTimer = null; } }
    function startThreeStage(x,y){
      stopSequence();
      createBurst(x,y,0.6);
      setTimeout(()=>{ createBurst(x,y,1.2); createBurst(x+rand(-40,40), y+rand(-40,40), 0.9); }, 1000);
      setTimeout(()=>{ createBurst(x,y,2.6); const w=canvas.clientWidth, h=canvas.clientHeight; for(let i=0;i<8;i++){ createBurst(rand(w*0.05,w*0.95), rand(h*0.05,h*0.95), 1.6+Math.random()*1.2); } }, 2000);
      sequenceTimer = setTimeout(stopSequence, 3500);
    }
    function pointerToCanvas(e){ const r = canvas.getBoundingClientRect(); return { x: (e.touches ? e.touches[0].clientX : e.clientX) - r.left, y: (e.touches ? e.touches[0].clientY : e.clientY) - r.top }; }
    canvas.addEventListener('pointerdown', e => { const p = pointerToCanvas(e); startThreeStage(p.x, p.y); });
    window.FireworksWidget = { start: startThreeStage, clear: ()=>{ particles.length = 0; stopSequence(); } };
    requestAnimationFrame(resize);
  })();
  </script>
</body>
</html>
